baby - Pwn - 50 pts - created by grimmlin
==========================================

Baby's first... Should be easy!
Challenge : here
Running on: ```baby.teaser.insomnihack.ch:1337```




Decompilation
==============

* handle()
```c
__int64 __fastcall handle(int fd)
{
  char choice; // [sp+10h] [bp-10h]@2
  __int64 cookie; // [sp+18h] [bp-8h]@1

  cookie = *MK_FP(__FS__, 40LL);
  do
  {
    while ( 1 )
    {
      while ( 1 )
      {
        while ( 1 )
        {
          sendstr(
            fd,
            "Welcome to baby's first pwn.\n"
            "Pick your favorite vuln : \n"
            "   1. Stack overflow\n"
            "   2. Format string\n"
            "   3. Heap Overflow\n"
            "   4. Exit\n"
            "Your choice > ");
          recvlen(fd, (__int64)&choice, 2uLL);
          if ( choice != '2' )
            break;
          dofmt(fd);
        }
        if ( choice > '2' )
          break;
        if ( choice == '1' )
          dostack(fd);
      }
      if ( choice != '3' )
        break;
      doheap(fd);
    }
  }
  while ( choice != '4' );
  return 0LL;
}
```


* dostack()
```c
__int64 __fastcall dostack(int fd)
{
  int len; // ST1C_4@1
  __int64 result; // rax@1
  __int64 v3; // rcx@1
  char buf; // [sp+20h] [bp-410h]@1
  __int64 cookie; // [sp+428h] [bp-8h]@1

  cookie = *MK_FP(__FS__, 40LL);
  sendstr(fd, "How much bytes you want to send ? ");
  recv(fd, &buf, 10uLL, 0);
  len = atoi(&buf);
  recvlen(fd, (__int64)&buf, len);
  sendstr(fd, "Good luck !\n");
  result = 0LL;
  v3 = *MK_FP(__FS__, 40LL) ^ cookie;
  return result;
}
```



* dofmt()
```c
__int64 __fastcall dofmt(int fd)
{
  unsigned int recv; // [sp+1Ch] [bp-414h]@2
  char user_input[1032]; // [sp+20h] [bp-410h]@2
  __int64 cookie; // [sp+428h] [bp-8h]@1

  cookie = *MK_FP(__FS__, 40LL);
  sendstr(fd, "Simply type '\\n' to return\n");
  while ( 1 )
  {
    sendstr(fd, "Your format > ");
    recv = recvlen_until(fd, user_input, 1024uLL, "\n");
    if ( recv == 1 )
      break;
    printf("%d\n", recv);
    puts(user_input);
    user_input[recv] = 0;
    dprintf(fd, user_input);
  }
  return 0LL;
}
```